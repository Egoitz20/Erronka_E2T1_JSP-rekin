DROP TABLE IRAKASGAIAK;
DROP TABLE IKASLEAK;
DROP TABLE MATRIKULA;
DROP TABLE HERRIAK;

CREATE TABLE IRAKASGAIAK (
	KODEA INT PRIMARY KEY,
    IZENA VARCHAR(25) NOT NULL
);

CREATE TABLE IKASLEAK(
	NA VARCHAR(9) PRIMARY KEY,
    IZENA VARCHAR(25) NOT NULL
); 

CREATE TABLE MATRIKULA (
	NA VARCHAR(9) NOT NULL,
    KODEA INT NOT NULL, 
    DATAK DATETIME NOT NULL,
    PRIMARY KEY (NA, KODEA, DATAK), 
    CONSTRAINT FK_KODEA FOREIGN KEY (KODEA) REFERENCES IRAKASGAIAK (KODEA),
    CONSTRAINT FK_NA FOREIGN KEY (NA) REFERENCES IKASLEAK (NA)
);

CREATE TABLE HERRIAK (
	KODEA INT PRIMARY KEY,
    IZENA VARCHAR(25)
);

INSERT INTO IKASLEAK (NA, IZENA) VALUES ('11111111A', 'Egoitz');
INSERT INTO IKASLEAK (NA, IZENA) VALUES ('22222222A', 'Ane');
INSERT INTO IKASLEAK (NA, IZENA) VALUES ('33333333A', 'Imanol');
INSERT INTO IKASLEAK (NA, IZENA) VALUES ('44444444A', 'Zunbeltz');

INSERT INTO IRAKASGAIAK (KODEA, IZENA) VALUES (1, 'PROG');
INSERT INTO IRAKASGAIAK (KODEA, IZENA) VALUES (2, 'BAD');
INSERT INTO IRAKASGAIAK (KODEA, IZENA) VALUES (3, 'LEN');
INSERT INTO IRAKASGAIAK (KODEA, IZENA) VALUES (4, 'ENT');

INSERT INTO MATRIKULA (NA, KODEA, DATAK) VALUES ('11111111A', 1, now());
INSERT INTO MATRIKULA (NA, KODEA, DATAK) VALUES ('22222222A', 1, now());
INSERT INTO MATRIKULA (NA, KODEA, DATAK) VALUES ('22222222A', 2, now());
INSERT INTO MATRIKULA (NA, KODEA, DATAK) VALUES ('44444444A', 4, now());
INSERT INTO MATRIKULA (NA, KODEA, DATAK) VALUES ('33333333A', 3, now());

INSERT INTO HERRIAK (KODEA, IZENA) VALUES (1, 'Barakaldo');
INSERT INTO HERRIAK (KODEA, IZENA) VALUES (2, 'Trapagaran');

SELECT NA, IZENA FROM IKASLEAK WHERE NA = '11111111A';
SELECT * FROM IRAKASGAIAK WHERE KODEA = 2 AND IZENA = 'BAD';
SELECT * FROM IRAKASGAIAK ORDER BY IZENA;
SELECT * FROM IKASLEAK, IRAKASGAIAK;

ALTER TABLE IKASLEAK ADD COLUMN HERRIKODEA INT, ADD CONSTRAINT FK_HERRIKODEA FOREIGN KEY (HERRIKODEA) REFERENCES HERRIAK (KODEA);

UPDATE IKASLEAK SET HERRIKODEA = 1 WHERE NA = '11111111A';
UPDATE IKASLEAK SET HERRIKODEA = 2 WHERE NA = '22222222A';
UPDATE IKASLEAK SET HERRIKODEA = 1 WHERE NA = '33333333A';
UPDATE IKASLEAK SET HERRIKODEA = 2 WHERE NA = '44444444A';

SELECT * FROM IKASLEAK, HERRIAK;
SELECT * FROM IKASLEAK, HERRIAK WHERE IKASLEAK.HERRIKODEA = HERRIAK.KODEA;

INSERT INTO HERRIAK (KODEA, IZENA) VALUES (3, 'Santurtzi');

SELECT * FROM IKASLEAK, HERRIAK WHERE IKASLEAK.HERRIKODEA = HERRIAK.KODEA;

INSERT INTO IKASLEAK (NA, IZENA) VALUES ('55555555A', 'Andoni');

SELECT * FROM IKASLEAK, HERRIAK WHERE IKASLEAK.HERRIKODEA = HERRIAK.KODEA;
SELECT * FROM IKASLEAK INNER JOIN HERRIAK ON IKASLEAK.HERRIKODEA = HERRIAK.KODEA;
SELECT * FROM IKASLEAK LEFT JOIN HERRIAK ON IKASLEAK.HERRIKODEA = HERRIAK.KODEA;
SELECT * FROM IKASLEAK RIGHT JOIN HERRIAK ON IKASLEAK.HERRIKODEA = HERRIAK.KODEA;

SELECT IKASLEAK.IZENA, MATRIKULA.DATAK, IRAKASGAIAK.IZENA FROM IKASLEAK 
INNER JOIN MATRIKULA ON IKASLEAK.NA = MATRIKULA.NA
INNER JOIN IRAKASGAIAK ON MATRIKULA.KODEA = IRAKASGAIAK.KODEA
ORDER BY IKASLEAK.IZENA, IRAKASGAIAK.IZENA DESC;

INSERT INTO MATRIKULA (NA, KODEA, DATAK) VALUES ('11111111A', 2, now());

SELECT COUNT(NA), KODEA FROM MATRIKULA GROUP BY KODEA;

SELECT COUNT(MATRIKULA.NA) AS KOPURUA, IRAKASGAIAK.IZENA FROM MATRIKULA INNER JOIN IRAKASGAIAK ON MATRIKULA.KODEA = IRAKASGAIAK.KODEA GROUP BY IRAKASGAIAK.IZENA;

SELECT SUM(KODEA) AS KODEARENGEHIKETA, NA FROM MATRIKULA WHERE YEAR(DATAK)='2025' GROUP BY NA;

SELECT IZENA, LENGTH(IZENA) AS LUZEERA FROM IKASLEAK;
SELECT IZENA, UPPER(IZENA) AS LARRIA FROM IKASLEAK;
SELECT IZENA, LOWER(IZENA) AS TXIKIA FROM IKASLEAK;
SELECT IZENA, SUBSTRING(IZENA, 1, 3) AS LETRA_SELEKZIOA FROM IKASLEAK;
SELECT IZENA, SUBSTRING(IZENA, 1, 1) AS LETRA_SELEKZIOA FROM IKASLEAK;
SELECT IZENA, SUBSTRING(IZENA, 2, 4) AS LETRA_SELEKZIOA FROM IKASLEAK;

SELECT SUBSTRING(DATAK, 1, 4) FROM MATRIKULA;

SELECT NOW() AS HORAINGODATA;
SELECT YEAR(NOW());
SELECT YEAR(NOW()) FROM DUAL;

SELECT ABS(-5);
SELECT ABS(5);

SELECT POWER (2, 10); /* BERREKETA */

SELECT * FROM IKASLEAK WHERE NA IN (SELECT NA FROM MATRIKULA);

SELECT NA, IZENA, HERRIKODEA FROM IKASLEAK WHERE HERRIKODEA IS NOT NULL
UNION
SELECT NA, IZENA, HERRIKODEA FROM IKASLEAK WHERE HERRIKODEA IS NULL;

SELECT * FROM IKASLEAK WHERE IZENA LIKE 'And%';
SELECT * FROM IKASLEAK WHERE IZENA LIKE '%doni';
SELECT * FROM IKASLEAK WHERE IZENA LIKE '&o%';

SELECT * FROM IKASLEAK WHERE IZENA <> 'Andoni';
SELECT * FROM IKASLEAK WHERE IZENA != 'Andoni';

SELECT * FROM HERRIAK WHERE NOT KODEA = 3;
/*SELECT * FROM HERRIAK WHERE !KODEA = 3;*/

SELECT * FROM HERRIAK WHERE KODEA = 3;
SELECT * FROM HERRIAK WHERE KODEA BETWEEN 1 AND 2;

SELECT * FROM IKASLEAK WHERE ADINA BETWEEN 0 AND 17;
SELECT * FROM IKASLEAK WHERE ADINA < 18;

SELECT * FROM IKASLEAK;
SELECT * FROM IKASLEAK LIMIT 2;
SELECT * FROM IKASLEAK LIMIT 2 OFFSET 2;

SELECT * FROM MATRIKULA;
SELECT NA, COUNT(KODEA) FROM MATRIKULA GROUP BY NA HAVING COUNT(KODEA) > 1;

SELECT * FROM IKASLEAK WHERE NA IN (SELECT NA FROM IKASLEAK WHERE IZENA = 'Egoitz');
SELECT * FROM (SELECT * FROM IKASLEAK) AS SUBQUERY; 

CREATE VIEW NIREIKASLEAK AS
SELECT NA, IZENA, HERRIKODEA FROM IKASLEAK WHERE HERRIKODEA IS NOT NULL
UNION
SELECT NA, IZENA, HERRIKODEA FROM IKASLEAK WHERE HERRIKODEA IS NULL;
SELECT * FROM NIREIKASLEAK;
SELECT * FROM NIREIKASLEAK WHERE IZENA = 'Imanol';
