DROP TABLE IF EXISTS ESKARI_LERRO;
DROP TABLE IF EXISTS INBENTARIO;
DROP TABLE IF EXISTS ESKARI;
DROP TABLE IF EXISTS BEZERO_TELEFONO;
DROP TABLE IF EXISTS BULEGARI;
DROP TABLE IF EXISTS SALTZAILE;
DROP TABLE IF EXISTS LANGILE;
DROP TABLE IF EXISTS PRODUKTU;
DROP TABLE IF EXISTS KATEGORIA;	
DROP TABLE IF EXISTS BILTEGI;
DROP TABLE IF EXISTS KOKALEKU;
DROP TABLE IF EXISTS HERRIALDE;
DROP TABLE IF EXISTS KONTINENTE;
DROP TABLE IF EXISTS ESKARI_EGOERA;
DROP TABLE IF EXISTS LANPOSTU;
DROP TABLE IF EXISTS BEZERO;
DROP TABLE IF EXISTS ERABILTZAILEAK;

CREATE TABLE KONTINENTE (
    ID INT(1) PRIMARY KEY,
    IZENA VARCHAR(25) NOT NULL
);

CREATE TABLE HERRIALDE (
    ID CHAR(2) PRIMARY KEY,
    IZENA VARCHAR(40) NOT NULL,
    ID_KONTINENTE INT(1) NOT NULL,
    CONSTRAINT FKID_KONTINENTE FOREIGN KEY(ID_KONTINENTE) REFERENCES KONTINENTE(ID)    
);

CREATE TABLE KOKALEKU (
    ID INT(4) PRIMARY KEY,
    HELBIDEA VARCHAR(255) NOT NULL,
    POSTAKODEA VARCHAR(20),
    UDALERRIA VARCHAR(50) NOT NULL,
    PROBINTZIA VARCHAR(50),
    ID_HERRIALDE CHAR(2) NOT NULL,
    CONSTRAINT FKID_HERRIALDE FOREIGN KEY(ID_HERRIALDE) REFERENCES HERRIALDE(ID)
);

CREATE TABLE BILTEGI (
    ID INT(3) PRIMARY KEY, 
    IZENA VARCHAR(255) NOT NULL,
    ID_KOKALEKU INT(4) NOT NULL, 
    CONSTRAINT FKID_KOKALEKU FOREIGN KEY(ID_KOKALEKU) REFERENCES KOKALEKU(ID)    
);

CREATE TABLE BEZERO (
    ID INT(5) PRIMARY KEY,
    IZENA VARCHAR(50) NOT NULL,
    ABIZENA VARCHAR(100) NOT NULL,
    HELBIDEA VARCHAR(255),
    EMAILA VARCHAR(50) NOT NULL
);

CREATE TABLE BEZERO_TELEFONO (
    ID INT(6) PRIMARY KEY NOT NULL AUTO_INCREMENT,
    ID_BEZERO INT(5) NOT NULL,
    ZENBAKIA VARCHAR(13) NOT NULL,
    CONSTRAINT FKID_BEZERO_TEL FOREIGN KEY(ID_BEZERO) REFERENCES BEZERO(ID) ON DELETE CASCADE    
);

CREATE TABLE LANPOSTU (
    ID INT(2) PRIMARY KEY,
    DESKRIBAPENA VARCHAR(150) NOT NULL
);

CREATE TABLE LANGILE (
    ID INT(4) PRIMARY KEY,
    IZENA VARCHAR(50) NOT NULL,
    ABIZENA VARCHAR(50) NOT NULL,
    EMAILA VARCHAR(50) NOT NULL,
    TELEFONOA VARCHAR(50), 
    KONTRATAZIO_DATA DATE NOT NULL,
    ID_NAGUSI INT(4),
    CONSTRAINT FKID_NAGUSI FOREIGN KEY(ID_NAGUSI) REFERENCES LANGILE(ID)    
);

CREATE TABLE SALTZAILE (
    ID INT(4) PRIMARY KEY,
    ERABILTZAILEA VARCHAR(25) NOT NULL UNIQUE,
    PASAHITZA VARCHAR(25) NOT NULL,
    CONSTRAINT FK_SALTZAILE_LANGILE FOREIGN KEY(ID) REFERENCES LANGILE(ID) ON DELETE CASCADE    
);

CREATE TABLE BULEGARI (
    ID INT(4) PRIMARY KEY,
    ID_LANPOSTU INT(2) NOT NULL,
    CONSTRAINT FK_BULEGARI_LANGILE FOREIGN KEY(ID) REFERENCES LANGILE(ID) ON DELETE CASCADE,    
    CONSTRAINT FKID_LANPOSTU FOREIGN KEY(ID_LANPOSTU) REFERENCES LANPOSTU(ID)    
);

CREATE TABLE KATEGORIA (
    ID INT(2) PRIMARY KEY,
    IZENA VARCHAR(100) NOT NULL
);

CREATE TABLE PRODUKTU (
    ID INT(4) PRIMARY KEY,
    IZENA VARCHAR(255) NOT NULL,
    DESKRIBAPENA VARCHAR(2000),
    BALIOA DECIMAL(9,2) NOT NULL, 
    SALNEURRIA DECIMAL(9,2) NOT NULL,  
    ID_KATEGORIA INT(2) NOT NULL,
    CONSTRAINT FKID_KATEGORIA FOREIGN KEY(ID_KATEGORIA) REFERENCES KATEGORIA(ID),
    CONSTRAINT MIN_MAX CHECK (BALIOA BETWEEN 10 AND 10000)
);

CREATE TABLE ESKARI_EGOERA (
    ID INT(1) PRIMARY KEY,
    DESKRIBAPENA VARCHAR(10) NOT NULL,
    CONSTRAINT BALIO_POSIBLEAK CHECK (DESKRIBAPENA IN ('Pending', 'Canceled', 'Shipped'))
);

CREATE TABLE ESKARI (
    ID INT(5) PRIMARY KEY,
    ID_BEZERO INT(5) NOT NULL,
    ID_EGOERA INT(1) NOT NULL DEFAULT 1,
    ID_SALTZAILE INT(4),
    ESKAERA_DATA DATE NOT NULL,
    CONSTRAINT FK_ESKARI_BEZERO FOREIGN KEY(ID_BEZERO) REFERENCES BEZERO(ID),    
    CONSTRAINT FK_ESKARI_EGOERA FOREIGN KEY(ID_EGOERA) REFERENCES ESKARI_EGOERA(ID),
    CONSTRAINT FK_ESKARI_SALTZAILE FOREIGN KEY(ID_SALTZAILE) REFERENCES SALTZAILE(ID)    
);

CREATE TABLE ESKARI_LERRO (
    ID_ESKARI INT(5),
    ID_LERRO INT(5),
    ID_PRODUKTU INT(4) NOT NULL,
    KOPURUA INT(5) NOT NULL,
    SALNEURRIA DECIMAL(9,2) NOT NULL,
    PRIMARY KEY (ID_ESKARI, ID_LERRO),
    CONSTRAINT FK_ESKARI_LERRO_ESKARI FOREIGN KEY (ID_ESKARI) REFERENCES ESKARI(ID) ON DELETE CASCADE,
    CONSTRAINT FK_ESKARI_LERRO_PRODUKTU FOREIGN KEY (ID_PRODUKTU) REFERENCES PRODUKTU(ID)   
);

CREATE TABLE INBENTARIO (
    ID_PRODUKTU INT(4),
    ID_BILTEGI INT(3),
    KOPURUA INT(8) NOT NULL,
    PRIMARY KEY (ID_PRODUKTU, ID_BILTEGI), 
    CONSTRAINT FK_INBENTARIO_PRODUKTU FOREIGN KEY (ID_PRODUKTU) REFERENCES PRODUKTU(ID),
    CONSTRAINT FK_INBENTARIO_BILTEGI FOREIGN KEY (ID_BILTEGI) REFERENCES BILTEGI(ID)      
);

CREATE TABLE ERABILTZAILEAK (
	ID INT (99) PRIMARY KEY NOT NULL AUTO_INCREMENT,
	IZENA VARCHAR(25) NOT NULL UNIQUE,
	PASAHITZA VARCHAR(25) NOT NULL
);

INSERT INTO ERABILTZAILEAK (IZENA, PASAHITZA) VALUES ('admin', 'admin');