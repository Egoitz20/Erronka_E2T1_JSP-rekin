DROP TABLE BANKUAK;
DROP TABLE AKTIBITATEAK;
DROP TABLE ERABILTZAILEAK;
DROP TABLE ORDAINKETAK;
DROP TABLE AKTIBITATEAK_ERABILTZAILEAK;

CREATE TABLE BANKUAK (
	ENT_SUK INT NOT NULL PRIMARY KEY,
	IZENA VARCHAR(50),
	HELBIDEA VARCHAR(50),
	UDALERRIA VARCHAR(30),
	TELEFONOA VARCHAR(30)
);

CREATE TABLE AKTIBITATEAK (
	AKTIBITATE_KODEA VARCHAR(7) NOT NULL PRIMARY KEY,
	DESKRIBAPENA VARCHAR(50) NOT NULL,
	KUOTA INT
);

CREATE TABLE ERABILTZAILEAK (
	BAZKIDE_ZENBAKIA VARCHAR(7) NOT NULL,
	NAN VARCHAR(9) NOT NULL,
	IZENA VARCHAR(20),
	ABIZENAK VARCHAR(30),
	ARGAZKIA BLOB,
	HELBIDEA VARCHAR(40),
	UDALERRIA VARCHAR(50), 
	PK VARCHAR(5),
	JAIOTZE_DATA DATE,
	TELEFONOA VARCHAR(20), 
	ALTA_DATA DATE,
	BAJA_DATA DATE,
	BAZKIDE_KUOTA INT,
	FAMILIA_KUOTA INT,
	BANKU_ORDAINKETA CHAR,
	BANKU_KODEA INT,
	KONTUA INT,
	KONTROL_DIGITOA INT,
	OHARRAK VARCHAR(500),
	CONSTRAINT PK_BAZKIDE_NAN PRIMARY KEY (BAZKIDE_ZENBAKIA, NAN),
	CONSTRAINT FK_BANKU_KODEA FOREIGN KEY (BANKU_KODEA) REFERENCES BANKUAK(ENT_SUK),
	CONSTRAINT CK_URTE CHECK (JAIOTZE_DATA < 01/01/2008),
	CONSTRAINT CK_ALTA CHECK (BAJA_DATA > ALTA_DATA),
	CONSTRAINT CK_BAZKIDE CHECK (FAMILIA_KUOTA > BAZKIDE_KUOTA),
	CONSTRAINT CK_BANKU CHECK (BANKU_ORDAINKETA IN ('B','Z')) 
);

CREATE TABLE ORDAINKETAK (
	ERABILTZAILE_KODEA VARCHAR(7) NOT NULL,
	HILABETE_ZENBAKIA INT NOT NULL,
	KUOTA INT DEFAULT 150,
	OHARRAK VARCHAR(500),
	CONSTRAINT PK_ERABILTZAILE_HILABETE PRIMARY KEY (ERABILTZAILE_KODEA, HILABETE_ZENBAKIA),
	CONSTRAINT FK_ERABILTZAILE_KODEA FOREIGN KEY (ERABILTZAILE_KODEA) REFERENCES ERABILTZAILEAK(BAZKIDE_ZENBAKIA),
	CONSTRAINT CK_HILABETE CHECK (HILABETE_ZENBAKIA BETWEEN 1 AND 12)
);

CREATE TABLE AKTIBITATEAK_ERABILTZAILEAK (
	AKTIBITATE_KODEA VARCHAR(7) NOT NULL,
    ERABILTZAILE_KODEA VARCHAR(7) NOT NULL, 
    ALTA_DATA DATE,
    BAJA_DATA DATE,
    CONSTRAINT PK_AKTIBITATE_ERABILTZAILEA PRIMARY KEY (AKTIBITATE_KODEA, ERABILTZAILE_KODEA),
    CONSTRAINT FK_AKTIBITATE FOREIGN KEY (AKTIBITATE_KODEA) REFERENCES AKTIBITATEAK(AKTIBITATE_KODEA), 
    CONSTRAINT FK_ERABILTZAILE FOREIGN KEY (ERABILTZAILE_KODEA) REFERENCES ERABILTZAILEAK(BAZKIDE_ZENBAKIA),
    CONSTRAINT CK_ALTAK CHECK (BAJA_DATA > ALTA_DATA)
);